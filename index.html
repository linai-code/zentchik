<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–†–∞—Å—Å—ã–ª–∫–∞</title>
 <style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
    :root {
      --bg: #f6f8ff;
      --text: #00003c;
      --muted: #99a1c2;
      --brand: #0061ff;
      --brand-2: #00e4ca;
      --card: #ffffff;
      --bd: #ccdfff;
      --shadow: 0 4px 12px rgba(0, 97, 255, .1);
      --radius: 12px;
    }

    /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: url('https://media.discordapp.net/attachments/840140746891591720/1406372442317787346/image.png?ex=68a239e7&is=68a0e867&hm=1c9de3493a59511ef3716263007b44586b90e486418c543aa8dddc251fa47e75&=&format=webp&quality=lossless') no-repeat center center fixed;
      background-size: cover;
      font-family: "IBM Plex Sans", system-ui, sans-serif;
      color: var(--text);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container {
  max-width: 900px;
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.1); /* 10% –±–µ–ª–æ–≥–æ */
  border-radius: var(--radius);
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
.card {
  background: rgba(255, 255, 255, 0.1); /* 10% –±–µ–ª–æ–≥–æ */
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: var(--radius);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  padding: 1rem;
}


    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
    h2 {
      margin: 0 0 0.5rem;
      font-weight: 600;
      font-size: 1.1rem;
    }

    /* –í–≤–æ–¥–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
    input, select {
      width: 97.7%;
      padding: 0.4rem 0.5rem;
      border: 1px solid var(--bd);
      border-radius: 10px;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      outline: none;
    }

    input:focus, select:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px var(--brand-2);
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    button {
      display: inline-block;
      padding: 0.4rem 0.75rem;
      border-radius: 10px;
      border: 1px solid var(--bd);
      background: var(--brand);
      color: #fff;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }

    button:hover {
      background: #004bd1;
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */
    .editor-toolbar {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .editor-toolbar button {
      background: #fff;
      color: var(--text);
      border: 1px solid var(--bd);
    }

    .editor {
      min-height: 120px;
      padding: 0.6rem 0.75rem;
      border: 1px solid var(--bd);
      border-radius: 10px;
      background: #fff;
      outline: none;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 600px) {
      body {
        padding: 0.5rem;
      }
      .editor {
        min-height: 100px;
      }
    }
  </style>
<script>
const OWNER = 'linai-code';
const REPO = 'zentchik';

// –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ localStorage
let TOKEN = localStorage.getItem('github_token') || null;
if (!TOKEN) {
  TOKEN = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à GitHub Personal Access Token:");
  if (!TOKEN) {
    alert("–¢–æ–∫–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.");
    throw new Error("–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞");
  }
  localStorage.setItem('github_token', TOKEN);
}

const HEADERS = {
  'Authorization': `Bearer ${TOKEN}`,
  'Accept': 'application/vnd.github+json',
  'X-GitHub-Api-Version': '2022-11-28',
  'User-Agent': 'linai'
};

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ GitHub API
async function loadFromGitHub(filePath) {
  try {
    const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${filePath}?${Date.now()}`, { headers: HEADERS });
    if (!res.ok) return [];
    const fileData = await res.json();
    const decoded = decodeURIComponent(escape(atob(fileData.content)));
    return ensureArray(JSON.parse(decoded));
  } catch (e) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏", e);
    return [];
  }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ GitHub API
async function saveToGitHub(filePath, content, message) {
  const getRes = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${filePath}`, { headers: HEADERS });
  const fileData = await getRes.json();
  const sha = fileData.sha;

  const putRes = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${filePath}`, {
    method: 'PUT',
    headers: HEADERS,
    body: JSON.stringify({ message, content: btoa(unescape(encodeURIComponent(content))), sha })
  });

  if (!putRes.ok) {
    const err = await putRes.json();
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + err.message);
  }
}

function ensureArray(data){
  if(Array.isArray(data)) return data;
  if(!data) return [];
  return Object.values(data);
}

let posts = [];
let channels = [];

async function loadPosts() {
  posts = await loadFromGitHub('posts.json');
  renderPosts();
}

async function loadChannels() {
  channels = await loadFromGitHub('channels.json');
  renderChannels();
}

async function savePosts() { await saveToGitHub('posts.json', JSON.stringify(posts, null, 2), 'update posts'); }
async function saveChannels() { await saveToGitHub('channels.json', JSON.stringify(channels, null, 2), 'update channels'); }

function renderPosts() {
  const list = document.getElementById('list');
  const selectPost = document.getElementById('selectPost');
  list.innerHTML = '';
  selectPost.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø–∏—Å—å</option>';
  posts.forEach(p => {
    const date = p.createdAt ? new Date(p.createdAt).toLocaleString() : '‚Äî';
    const div = document.createElement('div');
    div.className = 'post';
    div.innerHTML = `<div>
        <strong>${p.title}</strong>
        <small style="color:var(--muted)">${date}</small>
        <div>${p.content.substring(0, 20)+"..."}</div>
      </div>`;
    const delBtn = document.createElement('button');
    delBtn.textContent = 'üóë';
    delBtn.onclick = () => deletePost(p.id);
    div.appendChild(delBtn);
    list.appendChild(div);
    const opt = document.createElement('option');
    opt.value = p.id;
    opt.textContent = p.title;
    selectPost.appendChild(opt);
  });
}

function renderChannels() {
  const channelsList = document.getElementById('channels');
  const selectChannel = document.getElementById('selectChannel');
  channelsList.innerHTML = '';
  selectChannel.innerHTML = '';
  channels.forEach(c => {
    const div = document.createElement('div');
    div.className = 'post';
    div.innerHTML = `<div><strong>${c.id}</strong></div>`;
    const delBtn = document.createElement('button');
    delBtn.textContent = 'üóë';
    delBtn.onclick = () => deleteChannel(c.id);
    div.appendChild(delBtn);
    channelsList.appendChild(div);
    const opt = document.createElement('option');
    opt.value = c.id;
    opt.textContent = c.id;
    selectChannel.appendChild(opt);
  });
}

async function deletePost(id) { posts = posts.filter(p => p.id !== id); await savePosts(); renderPosts(); }
async function deleteChannel(id) { channels = channels.filter(c => c.id !== id); await saveChannels(); renderChannels(); }

function formatText(command) { document.execCommand(command, false, null); }
function insertLink() {
  const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL');
  if (url) {
    let selection = window.getSelection();
    if (!selection.rangeCount) return;
    let range = selection.getRangeAt(0);
    if (selection.toString().length === 0) {
      const linkText = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∏') || url;
      const a = document.createElement('a');
      a.href = url;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.textContent = linkText;
      range.insertNode(a);
    } else {
      document.execCommand('createLink', false, url);
      document.querySelectorAll('a').forEach(a => {
        if (a.href === url || a.href === url + '/') {
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
        }
      });
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
  loadPosts();
  loadChannels();

  document.getElementById('createBtn').onclick = async () => {
  const title = document.getElementById('title').value.trim();
  const contentEl = document.getElementById('content');
  let content = contentEl.innerHTML;
  content = content.replace(/<div><br><\/div>/gi, '\n');
  content = content.replace(/<div>/gi, '\n');
  content = content.replace(/<\/div>/gi, '');
  content = content.replace(/<br\s*\/?>/gi, '\n');
  content = content.replace(/\r\n|\r/g, '\n');
  content = content.replace(/\n{3,}/g, '\n\n');
  content = content.trim();

  if (!title || !content) return alert('–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç');

  const id = crypto.randomUUID();
  posts.unshift({ id, title, content, createdAt: Date.now() });
  await savePosts();
  renderPosts();

  document.getElementById('title').value = '';
  document.getElementById('content').innerHTML = '';
};


  document.getElementById('addChannelBtn').onclick = async () => {
    const id = document.getElementById('channelId').value.trim();
    if (!id) return alert('–í–≤–µ–¥–∏—Ç–µ ID –∫–∞–Ω–∞–ª–∞');
    channels.push({ id });
    await saveChannels();
    renderChannels();
    document.getElementById('channelId').value = '';
  };

  document.getElementById('sendBtn').onclick = async () => {
    const postId = document.getElementById('selectPost').value;
    const channelSelect = document.getElementById('selectChannel');
    const selectedChannels = Array.from(channelSelect.selectedOptions).map(opt => opt.value);

    if (!postId || selectedChannels.length === 0) {
      return alert('–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø–∏—Å—å –∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–∞–Ω–∞–ª');
    }

    const payload = { 
      status: true, 
      postId, 
      channelIds: selectedChannels, 
      timestamp: new Date().toISOString() 
    };

    await saveToGitHub('send.json', JSON.stringify(payload, null, 2), 'send post');
    alert('–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
  };

  document.getElementById('resendBtn').onclick = async () => {
    const history = await loadFromGitHub('history.json');
    if (!history.length) {
      return alert('–í –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏');
    }

    const last = history[0]; // –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å
    const payload = {
      status: true,
      postId: last.postId,
      channelIds: last.channelIds,
      timestamp: new Date().toISOString()
    };

    await saveToGitHub('send.json', JSON.stringify(payload, null, 2), 'resend last post');
    alert('–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞');
  };
});
</script>
</head>
<body>
<div class="container">
  <div class="card">
    <h2>–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å</h2>
    <input id="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" />
    <div class="editor-toolbar">
      <button type="button" onclick="formatText('bold')"><b>B</b></button>
      <button type="button" onclick="insertLink()">üîó</button>
    </div>
    <div id="content" class="editor" contenteditable="true"></div>
    <button id="createBtn">–°–æ–∑–¥–∞—Ç—å</button>
  </div>
  <div class="card">
    <h2>–°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π</h2>
    <div id="list"></div>
  </div>
  <div class="card">
    <h2>–ö–∞–Ω–∞–ª—ã</h2>
    <input id="channelId" placeholder="ID –∫–∞–Ω–∞–ª–∞" />
    <button id="addChannelBtn">–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª</button>
    <div id="channels"></div>
  </div>
  <div class="card">
    <h2>–†–∞—Å—Å—ã–ª–∫–∞</h2>
    <select id="selectPost"></select>
    <select id="selectChannel" multiple size="10"></select>
    <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
      <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button id="resendBtn" style="background:#ff6600;">–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞</button>
    </div>
  </div>
</div>
</body>
</html>
